---
project: ozone-test
context:
    default: local
    list:
      - local
build_vars:
    NETWORK: "host"
    MICRO_A_DIR: ./micro-a
    MICRO_A_SERVICE: "micro-a"

builds:
  - name: b-micro-a
    dir: "{{MICRO_A_DIR}}"
    service: "{{MICRO_A_SERVICE}}"
    context_steps:
      - context: local
        steps:
          - type: builtin
            name: buildDockerImage
            with_vars:
              DOCKERFILE: "./micro-a/Dockerfile"
              FULL_TAG: micro-a:latest

deploys:
  - name: d-micro-a
    service: "{{MICRO_A_SERVICE}}"
    context_steps:
      - context: local
        steps:
          - type: builtin
            name: runDockerImage
            with_vars:
              NETWORK: "{{NETWORK}}"
              FULL_TAG: micro-a:latest
              PORT: 8081

  - name: all
    depends_on:
      - name: b-micro-a
      - name: d-micro-a